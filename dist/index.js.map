{"version":3,"sources":["../routes/index.js"],"names":["express","require","router","Router","dotenv","config","dateFormat","mysql","fs","connection","createConnection","host","user","password","process","env","dbpass","database","connect","e","console","log","cwd","get","req","res","next","render","title","query","err","rows","fields","json","l","readdirSync","length","post","submittedid","body","riotid","startsWith","includes","split","name","tag","today","Date","date","format","values","sendStatus","module","exports"],"mappings":"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","sourcesContent":["var express = require('express');\nvar router = express.Router();\nconst dotenv = require('dotenv');\ndotenv.config();\nvar dateFormat = require('../public/javascripts/date.format.js')\nvar mysql = require('mysql2')\nconst fs = require('fs');\ntry{\n  var connection = mysql.createConnection({\n    host: 'localhost',\n    user: 'frankwhoee',\n    password: process.env.dbpass,\n    database: 'sdn'\n  })\n  connection.connect()\n}catch (e) {\n  \n}\nconsole.log('Current directory: ' + process.cwd());\n/* GET home page. */\nrouter.get('/', function (req, res, next) {\n  res.render('index', {title: 'Express'});\n});\n\nrouter.get('/players', function (req, res, next) {\n  connection.query('SELECT * FROM players', function (err, rows, fields) {\n    if (err) throw err;\n\n    res.json(rows)\n  })\n});\n\nrouter.get('/covercount', function (req, res, next) {\n  var l = fs.readdirSync(process.cwd() + '/public/images/covers').length\n  res.json(l)\n});\n\nrouter.get('/count', function (req, res, next) {\n  connection.query('SELECT COUNT(1) FROM players', function (err, rows, fields) {\n    if (err) throw err;\n\n    res.json({\"count\":rows[0]['COUNT(1)']})\n  })\n});\n\nrouter.post('/idsubmit', function (req, res, next) {\n  const submittedid = req.body.riotid;\n  if (submittedid.startsWith(\"SDN\") && submittedid.includes(\"#\")) {\n    const split = submittedid.split(\"#\");\n    const name = split[0]\n    const tag = split[1]\n    const today = new Date()\n    const date = today.format(\"yyyy-mm-dd\")\n    try {\n\n      connection.query('SELECT COUNT(1) FROM players WHERE name=? AND tag=?', values = [name, tag], function (err, rows, fields) {\n        if (err) throw err;\n        if (rows[0]['COUNT(1)'] === 0) {\n          connection.query(\n              'INSERT INTO players VALUES (?, ?, ?);',\n              [name, tag, date]\n          )\n          res.sendStatus(200)\n        }else{\n          res.sendStatus(401)\n        }\n      })\n    } catch (e) {\n      res.sendStatus(500)\n    }\n  } else {\n    res.sendStatus(400)\n  }\n});\n\nmodule.exports = router;\n"],"file":"index.js"}